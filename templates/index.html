{% extends "base.html" %}
{% block title %}FDSReader Webapp — Home{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Hero -->
  <div class="text-center mb-5">
    <div class="display-1 mb-2">&#x1F525;</div>
    <h1 class="display-5 fw-bold">FDSReader <span class="text-danger">Webapp</span></h1>
    <p class="lead text-secondary">Interactive web interface for the <code>fdsreader</code> Python module</p>
  </div>

  <!-- Load simulation card -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card bg-dark border-secondary">
        <div class="card-header bg-dark border-secondary">
          <h5 class="mb-0"><i class="bi bi-folder2-open"></i> Load Simulation</h5>
        </div>
        <div class="card-body">
          <div class="input-group input-group-lg mb-2">
            <span class="input-group-text bg-dark border-secondary"><i class="bi bi-folder"></i></span>
            <input type="text" id="simPath" class="form-control bg-dark border-secondary text-light"
                   placeholder="/path/to/fds/output/directory"
                   value="">
            <button class="btn btn-outline-secondary" onclick="openBrowseModal()" title="Browse folders">
              <i class="bi bi-folder-symlink"></i>
            </button>
            <button class="btn btn-danger" onclick="loadSimulation()">
              <i class="bi bi-lightning-charge-fill"></i> Load
            </button>
          </div>
          <small class="text-secondary">Enter the path to your FDS output directory or <a href="#" onclick="openBrowseModal(); return false;" class="text-info">browse folders</a></small>
        </div>
      </div>

      <!-- Summary card (hidden until loaded) -->
      <div class="card bg-dark border-success mt-4 d-none" id="simSummaryCard">
        <div class="card-header bg-dark border-success">
          <h5 class="mb-0 text-success"><i class="bi bi-check-circle-fill"></i> Simulation Loaded</h5>
        </div>
        <div class="card-body">
          <div class="row text-center" id="simSummaryGrid">
            <!-- filled by JS -->
          </div>
          <hr class="border-secondary">
          <div class="d-flex flex-wrap gap-2 justify-content-center">
            <a href="/slices" class="btn btn-outline-info"><i class="bi bi-layers"></i> Slices</a>
            <a href="/boundaries" class="btn btn-outline-warning"><i class="bi bi-bricks"></i> Boundaries</a>
            <a href="/devices" class="btn btn-outline-light"><i class="bi bi-thermometer-half"></i> Devices</a>
            <a href="/hrr" class="btn btn-outline-danger"><i class="bi bi-fire"></i> HRR</a>
            <a href="/plot3d" class="btn btn-outline-info"><i class="bi bi-grid-3x3-gap"></i> Plot3D</a>
            <a href="/smoke3d" class="btn btn-outline-warning"><i class="bi bi-cloud-haze2"></i> Smoke3D</a>
            <a href="/particles" class="btn btn-outline-primary"><i class="bi bi-droplet-half"></i> Particles</a>
            <a href="/isosurfaces" class="btn btn-outline-success"><i class="bi bi-diamond-half"></i> Isosurfaces</a>
            <a href="/evacuation" class="btn btn-outline-warning"><i class="bi bi-person-walking"></i> Evacuation</a>
            <a href="/performance" class="btn btn-outline-success"><i class="bi bi-speedometer2"></i> Performance</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature grid -->
  <div class="row g-3 mt-5 justify-content-center">
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F4CA;</div><h6 class="text-info mt-1 small">SLCF Slices</h6><small class="text-secondary" style="font-size:.7rem">2D/3D slice data</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F9F1;</div><h6 class="text-warning mt-1 small">BNDF Boundaries</h6><small class="text-secondary" style="font-size:.7rem">Surface data</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F321;</div><h6 class="text-info mt-1 small">DEVC Devices</h6><small class="text-secondary" style="font-size:.7rem">Time-series sensors</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F525;</div><h6 class="text-danger mt-1 small">HRR Data</h6><small class="text-secondary" style="font-size:.7rem">Heat release rate</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F4E6;</div><h6 class="text-info mt-1 small">Plot3D</h6><small class="text-secondary" style="font-size:.7rem">3D volume cut-planes</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F32B;</div><h6 class="text-warning mt-1 small">Smoke3D</h6><small class="text-secondary" style="font-size:.7rem">Smoke volume data</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F4A7;</div><h6 class="text-primary mt-1 small">Particles</h6><small class="text-secondary" style="font-size:.7rem">Lagrangian tracking</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F48E;</div><h6 class="text-success mt-1 small">Isosurfaces</h6><small class="text-secondary" style="font-size:.7rem">Iso-contour meshes</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x1F6B6;</div><h6 class="text-warning mt-1 small">Evacuation</h6><small class="text-secondary" style="font-size:.7rem">Agent egress data</small></div>
      </div>
    </div>
    <div class="col-6 col-md-3 col-lg-2">
      <div class="card bg-dark border-secondary text-center h-100">
        <div class="card-body p-2"><div class="fs-2">&#x23F1;</div><h6 class="text-success mt-1 small">Performance</h6><small class="text-secondary" style="font-size:.7rem">CPU & timestep data</small></div>
      </div>
    </div>
  </div>
</div>

<!-- ═══ DIRECTORY BROWSER MODAL ═══ -->
<div class="modal fade" id="browseModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content bg-dark border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title"><i class="bi bi-folder-symlink"></i> Browse Folders</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3">
          <span class="input-group-text bg-dark border-secondary"><i class="bi bi-geo-alt"></i></span>
          <input type="text" id="browsePath" class="form-control bg-dark border-secondary text-light" placeholder="/" onkeydown="if(event.key==='Enter')browseTo(this.value)">
          <button class="btn btn-outline-info" onclick="browseTo(document.getElementById('browsePath').value)">Go</button>
        </div>
        <div class="d-flex gap-2 mb-3">
          <button class="btn btn-outline-secondary btn-sm" onclick="browseUp()"><i class="bi bi-arrow-up"></i> Up</button>
          <span id="browseSmvBadge" class="badge bg-secondary align-self-center d-none"><i class="bi bi-check-circle"></i> .smv found</span>
        </div>
        <div id="browseDirList" class="list-group list-group-flush" style="max-height:400px; overflow-y:auto;">
          <small class="text-secondary">Click Go or type a path.</small>
        </div>
      </div>
      <div class="modal-footer border-secondary">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success" id="browseSelectBtn" onclick="browseSelect()">
          <i class="bi bi-check-lg"></i> Select This Folder
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('simPath').addEventListener('keydown', e => {
  if (e.key === 'Enter') loadSimulation();
});
</script>
{% endblock %}
